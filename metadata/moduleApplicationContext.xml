<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!-- Beans to add to the current Application context definition -->

<beans>

	<!--  **************************  SERVICES  *************************  -->

	<bean parent="serviceContext">
		<property name="moduleService">
			<list>
				<value>org.openmrs.module.reportingcompatibility.ReportingCompatibilityService</value> 
				<bean class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
					<property name="transactionManager"><ref bean="transactionManager"/></property>
					<property name="target">
						<bean class="org.openmrs.module.reportingcompatibility.impl.ReportingCompatibilityServiceImpl">
							<property name="reportingCompatibilityDAO">
							    <bean class="org.openmrs.module.reportingcompatibility.db.hibernate.HibernateReportingCompatibilityDAO">
									<property name="sessionFactory"><ref bean="sessionFactory"/></property>	
								</bean>
							</property>	
							<property name="cohortDefinitionProviders">
								<map>
									<entry>
										<key><value>org.openmrs.reporting.PatientSearch</value></key>
										<bean class="org.openmrs.cohort.impl.PatientSearchCohortDefinitionProvider"/>
									</entry>
									<entry>
										<key><value>org.openmrs.cohort.StaticCohortDefinition</value></key>
										<bean class="org.openmrs.cohort.impl.StaticCohortDefinitionProvider"/>
									</entry>
								</map>
							</property>
						</bean>
					</property>
					<property name="preInterceptors">
						<list>
							<ref bean="authorizationInterceptor"/>
							<ref bean="loggingInterceptor"/>
						</list>
					</property>
					<property name="transactionAttributeSource">
						<bean class="org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"/>
					</property>
				</bean>
			</list>
		</property>
	</bean>
	<bean parent="serviceContext">
		<property name="moduleService">
			<list>
				<value>org.openmrs.api.DataSetService</value> 
				<bean class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
					<property name="transactionManager"><ref bean="transactionManager"/></property>
					<property name="target">
						<bean class="org.openmrs.report.impl.DataSetServiceImpl">
							<property name="providers">
								<list>
									<bean class="org.openmrs.report.CohortDataSetProvider"/>
									<bean class="org.openmrs.report.RowPerObsDataSetProvider"/>
									<bean class="org.openmrs.report.RowPerProgramEnrollmentDataSetProvider"/>
								</list>
							</property>
						</bean>
					</property>
					<property name="preInterceptors">
						<list>
							<ref bean="authorizationInterceptor"/>
							<ref bean="loggingInterceptor"/>
						</list>
					</property>
					<property name="transactionAttributeSource">
						<bean class="org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"/>
					</property>
				</bean>
			</list>
		</property>
	</bean>
	<bean parent="serviceContext">
		<property name="moduleService">
			<list>
				<value>org.openmrs.api.ReportService</value> 
				<bean class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
					<property name="transactionManager"><ref bean="transactionManager"/></property>
					<property name="target">
						<bean class="org.openmrs.report.impl.ReportServiceImpl">
							<property name="reportDAO">
							    <bean id="reportDAO" class="org.openmrs.report.db.hibernate.HibernateReportDAO">
									<property name="sessionFactory"><ref bean="sessionFactory"/></property>	
								</bean>
							</property>	
							<property name="renderers">
								<map>
									<entry>
										<key><value>org.openmrs.report.impl.TsvReportRenderer</value></key>
										<bean class="org.openmrs.report.impl.TsvReportRenderer"/>
									</entry>
									<entry>
										<key><value>org.openmrs.report.impl.CsvReportRenderer</value></key>
										<bean class="org.openmrs.report.impl.CsvReportRenderer"/>
									</entry>
									<entry>
										<key><value>org.openmrs.web.report.CohortReportWebRenderer</value></key>
										<bean class="org.openmrs.web.report.CohortReportWebRenderer"/>
									</entry>
								</map>
							</property>
						</bean>
					</property>
					<property name="preInterceptors">
						<list>
							<ref bean="authorizationInterceptor"/>
							<ref bean="loggingInterceptor"/>
						</list>
					</property>
					<property name="transactionAttributeSource">
						<bean class="org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"/>
					</property>
				</bean>
			</list>
		</property>
	</bean>
	<bean parent="serviceContext">
		<property name="moduleService">
			<list>
				<value>org.openmrs.reporting.ReportObjectService</value> 
				<bean class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
					<property name="transactionManager"><ref bean="transactionManager"/></property>
					<property name="target">
						<bean id="reportObjectServiceTarget" class="org.openmrs.reporting.impl.ReportObjectServiceImpl">
							<property name="reportObjectDAO">
								<bean class="org.openmrs.reporting.db.hibernate.HibernateReportObjectDAO">
									<property name="sessionFactory"><ref bean="sessionFactory"/></property>	
								</bean>
							</property>	
						</bean>
					</property>
					<property name="preInterceptors">
						<list>
							<ref bean="authorizationInterceptor"/>
							<ref bean="loggingInterceptor"/>
						</list>
					</property>
					<property name="transactionAttributeSource">
						<bean class="org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"/>
					</property>
				</bean>		
			</list>
		</property>
	</bean>

	<!--  **************************  REPORT OBJECT FACTORY CONFIGURATION  *************************  -->

	<!-- Configuration for reporting module - sets up the report object factory and admin interface
		USAGE: To add/create a report object to use in the reporting system, you need to do 3 things:
		1) Create the class for the report object - preferably put it in org.openmrs.api.reporting.*
		2) Create a validator for the report object (one that is used whenever somebody tries to create a 
		new object of that type, and populate it with initial values - these values should be validated).
		Preferably put that in the same directory mentioned above.
		3) Register it as a module to the ReportObjectFactory below and also be sure to make a bean def
		for the module (CALLEN)
	-->

	<bean id="reportObjectFactory" class="org.openmrs.reporting.ReportObjectFactory">
		<property name="defaultValidator"><value>org.openmrs.web.controller.report.ReportObjectValidator</value></property>
		<property name="modules">
			<list>
				<ref bean="patientCharacteristicFilterModule" />
				<ref bean="drugOrderFilterModule" />
				<ref bean="numericObsPatientFilterModule" />
				<ref bean="locationFilterModule" />
				<ref bean="textObsPatientFilterModule" />
			</list>
		</property>
	</bean>

	<bean id="patientCharacteristicFilterModule"
		class="org.openmrs.reporting.ReportObjectFactoryModule">
		<property name="name"><value>PatientCharacteristicFilter</value></property>
		<property name="displayName"><value>Patient Characteristic Filter</value></property>
		<property name="className"><value>org.openmrs.reporting.PatientCharacteristicFilter</value></property>
		<property name="type"><value>Patient Filter</value></property>
		<property name="validatorClass"><value>org.openmrs.reporting.PatientCharacteristicFilterValidator</value></property>
	</bean>

	<bean id="drugOrderFilterModule" class="org.openmrs.reporting.ReportObjectFactoryModule">
		<property name="name"><value>DrugOrderFilter</value></property>
		<property name="displayName"><value>Regimen Filter</value></property>
		<property name="className"><value>org.openmrs.reporting.DrugOrderPatientFilter</value></property>
		<property name="type"><value>Patient Filter</value></property>
		<property name="validatorClass"><value>org.openmrs.reporting.DrugOrderPatientFilterValidator</value></property>
	</bean>

	<bean id="numericObsPatientFilterModule"
		class="org.openmrs.reporting.ReportObjectFactoryModule">
		<property name="name"><value>NumericObsPatientFilter</value></property>
		<property name="displayName"><value>Numeric Observation Patient Filter</value></property>
		<property name="className"><value>org.openmrs.reporting.NumericObsPatientFilter</value></property>
		<property name="type"><value>Patient Filter</value></property>
		<property name="validatorClass"><value>org.openmrs.reporting.NumericObsPatientFilterValidator</value></property>
	</bean>

	<bean id="locationFilterModule" class="org.openmrs.reporting.ReportObjectFactoryModule">
		<property name="name"><value>LocationFilter</value></property>
		<property name="displayName"><value>Location Filter</value></property>
		<property name="className"><value>org.openmrs.reporting.LocationFilter</value></property>
		<property name="type"><value>Patient Filter</value></property>
		<property name="validatorClass"><value>org.openmrs.reporting.LocationFilterValidator</value></property>
	</bean>

	<bean id="textObsPatientFilterModule" class="org.openmrs.reporting.ReportObjectFactoryModule">
		<property name="name"><value>TextObsPatientFilter</value></property>
		<property name="displayName"><value>Text Observation Patient Filter</value></property>
		<property name="className"><value>org.openmrs.reporting.TextObsPatientFilter</value></property>
		<property name="type"><value>Patient Filter</value></property>
		<property name="validatorClass"><value>org.openmrs.reporting.TextObsPatientFilterValidator</value></property>
	</bean>
	
	<bean id="shortDescriptionProducerModule" class="org.openmrs.reporting.ReportObjectFactoryModule">
		<property name="name"><value>ShortDescriptionProducer</value></property>
		<property name="displayName"><value>Short Description Producer</value></property>
		<property name="className"><value>org.openmrs.reporting.ShortDescriptionProducer</value></property>
		<property name="type"><value>Patient Data Producer</value></property>
		<property name="validatorClass"><value>org.openmrs.reporting.ShortDescriptionProducerValidator</value></property>
	</bean>
	
	<!--  **************************  WEB MAPPINGS  *************************  -->
	
	<bean id="reportingCompatibilityUrlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="order"><value>20</value></property>
		<property name="mappings">
			<props>
				<prop key="/admin/reports/dataExport.list">dataExportList</prop>
				<prop key="/admin/reports/dataExport.form">dataExportForm</prop>
				<prop key="/admin/reports/rowPerObsDataExport.list">rowPerObsDataExportList</prop>
				<prop key="/admin/reports/rowPerObsDataExport.form">rowPerObsDataExportForm</prop>
				<prop key="/admin/reports/reportObject.list">reportObjectList</prop>
				<prop key="/admin/reports/reportObject.form">reportObjectForm</prop>
				<prop key="/admin/reports/cohorts.list">cohortList</prop>
				<prop key="/admin/reports/patientSearch.list">patientSearchList</prop>
				<prop key="/admin/reports/patientSearch.form">patientSearchForm</prop>
				<prop key="/admin/reports/runReport.list">reportsList</prop>
				<prop key="/admin/reports/runReport.form">runReportForm</prop>
                <prop key="/admin/reports/reportData.form">reportDataForm</prop>
                <prop key="/admin/reports/reportData.list">reportDataList</prop>
                <prop key="/admin/reports/reportSchemaXml.form">reportSchemaXmlForm</prop>
                <prop key="/admin/reports/reportSchemaXml.list">reportSchemaXmlList</prop>
                <prop key="/admin/reports/reportMacros.form">reportMacrosForm</prop>
                <prop key="/admin/reports/cohortReport.form">cohortReportForm</prop>
				<prop key="cohortBuilder.list">cohortBuilderController</prop>
				<prop key="cohortBuilder.form">cohortBuilderActionController</prop>
				<prop key="**/patientSet.portlet">patientSetPortletController</prop>
				<prop key="nealreport.form">nealReportController</prop>
			</props>
		</property>
	</bean>
	
		<!--  **************************  WEB CONTROLLERS  *************************  -->

	<bean id="patientSetPortletController" class="org.openmrs.web.controller.PatientSetPortletController" />
	<bean id="nealReportController" class="org.openmrs.web.controller.nealreports.NealReportController" />
	
	<bean id="reportsList" class="org.openmrs.web.controller.report.ReportsListController">
        <property name="commandName"><value>reports</value></property>
        <property name="formView"><value>/module/@MODULE_ID@/reports/runReportList</value></property>
        <property name="successView"><value>runReport.list</value></property>
    </bean>
    <bean id="runReportForm" class="org.openmrs.web.controller.report.RunReportController">
        <property name="commandName"><value>report</value></property>
        <property name="formView"><value>/module/@MODULE_ID@/reports/runReportForm</value></property>
        <property name="successView"><value>runReport.list</value></property>
        <property name="validator">
		    <ref bean="runReportForm" />
		</property>
    </bean>
    <bean id="reportDataForm" class="org.openmrs.web.controller.report.ReportDataFormController">
        <property name="commandName"><value>reportData</value></property>
        <property name="formView"><value>/module/@MODULE_ID@/reports/reportDataForm</value></property>
        <property name="successView"><value>reportData.form</value></property>
    </bean>
    <bean id="reportDataList" class="org.openmrs.web.controller.report.ReportDataListController">
        <property name="commandName"><value>reportData</value></property>
        <property name="formView"><value>/module/@MODULE_ID@/reports/reportDataList</value></property>
        <property name="successView"><value>reportData.list</value></property>
    </bean>
    <bean id="reportSchemaXmlForm" class="org.openmrs.web.controller.report.ReportSchemaXmlFormController">
        <property name="commandName"><value>reportSchemaXml</value></property>
        <property name="formView"><value>/module/@MODULE_ID@/reports/reportSchemaXmlForm</value></property>
        <property name="successView"><value>reportSchemaXml.list</value></property>
        <property name="validator">
			<ref bean="reportSchemaXmlForm" />
		</property>
    </bean>
    <bean id="reportSchemaXmlList" class="org.openmrs.web.controller.report.ReportSchemaXmlListController">
        <property name="commandName"><value>reportSchemaXmlList</value></property>
        <property name="formView"><value>/module/@MODULE_ID@/reports/reportSchemaXmlList</value></property>
        <property name="successView"><value>reportSchemaXml.list</value></property>
    </bean>
    <bean id="reportMacrosForm" class="org.openmrs.web.controller.report.ReportMacrosFormController">
        <property name="commandName"><value>command</value></property>
        <property name="formView"><value>/module/@MODULE_ID@/reports/reportMacrosForm</value></property>
        <property name="successView"><value>reportMacros.form</value></property>
    </bean>
    <bean id="cohortReportForm" class="org.openmrs.web.controller.report.CohortReportFormController">
        <property name="commandName"><value>command</value></property>
        <property name="formView"><value>/module/@MODULE_ID@/reports/cohortReportForm</value></property>
        <property name="successView"><value>cohortReport.form</value></property>
        <property name="validator">
			<ref bean="cohortReportForm" />
		</property>
    </bean>
    
	<bean id="reportObjectList"
		class="org.openmrs.web.controller.report.ReportObjectListController">
		<property name="sessionForm"><value>true</value></property>
		<property name="commandName"><value>reportObjectList</value></property>
		<property name="formView"><value>/module/@MODULE_ID@/reports/reportObjectList</value></property>
		<property name="successView"><value>reportObject.list</value></property>
	</bean>
	<bean id="reportObjectValidator" class="org.openmrs.validator.ReportObjectValidator" />
	<bean id="reportObjectForm" class="org.openmrs.web.controller.report.ReportObjectFormController">
		<property name="sessionForm"><value>false</value></property>
		<property name="commandName"><value>reportObject</value></property>
		<property name="validator">
			<ref bean="reportObjectValidator" />
		</property>
		<property name="formView"><value>/module/@MODULE_ID@/reports/reportObjectForm</value></property>
		<property name="successView"><value>reportObject.list</value></property>
	</bean>

	<bean id="dataExportList" class="org.openmrs.web.controller.report.export.DataExportListController">
		<property name="sessionForm"><value>true</value></property>
		<property name="commandName"><value>dataExportList</value></property>
		<property name="formView"><value>/module/@MODULE_ID@/reports/dataExportList</value></property>
		<property name="successView"><value>dataExport.list</value></property>
	</bean>

	<bean id="dataExportForm" class="org.openmrs.web.controller.report.export.DataExportFormController">
		<property name="sessionForm"><value>true</value></property>
		<property name="validator"><ref bean="requireNameValidator" /></property>
		<property name="commandName"><value>dataExport</value></property>
		<property name="formView"><value>/module/@MODULE_ID@/reports/dataExportForm</value></property>
		<property name="successView"><value>dataExport.list</value></property>
	</bean>
	
	<bean id="rowPerObsDataExportList" class="org.openmrs.web.controller.report.export.RowPerObsDataExportListController">
		<property name="sessionForm"><value>true</value></property>
		<property name="commandName"><value>dataExportList</value></property>
		<property name="formView"><value>/module/@MODULE_ID@/reports/rowPerObsDataExportList</value></property>
		<property name="successView"><value>rowPerObsDataExport.list</value></property>
	</bean>

	<bean id="rowPerObsDataExportForm" class="org.openmrs.web.controller.report.export.RowPerObsDataExportFormController">
		<property name="sessionForm"><value>true</value></property>
		<property name="validator"><ref bean="requireNameValidator" /></property>
		<property name="commandName"><value>dataExport</value></property>
		<property name="formView"><value>/module/@MODULE_ID@/reports/rowPerObsDataExportForm</value></property>
		<property name="successView"><value>rowPerObsDataExport.list</value></property>
	</bean>

	<bean id="cohortList" class="org.openmrs.web.controller.report.CohortListController">
		<property name="sessionForm"><value>true</value></property>
		<property name="commandName"><value>cohortList</value></property>
		<property name="formView"><value>/module/@MODULE_ID@/reports/cohortList</value></property>
		<property name="successView"><value>cohorts.list</value></property>
	</bean>

	<bean id="patientSearchList" class="org.openmrs.web.controller.report.PatientSearchListController">
		<property name="sessionForm"><value>true</value></property>
		<property name="commandName"><value>patientSearchList</value></property>
		<property name="formView"><value>/module/@MODULE_ID@/reports/patientSearchList</value></property>
		<property name="successView"><value>patientSearch.list</value></property>
	</bean>
	<bean id="patientSearchForm" class="org.openmrs.web.controller.report.PatientSearchFormController">
		<property name="sessionForm"><value>true</value></property>
		<property name="commandName"><value>patientSearchForm</value></property>
		<property name="formView"><value>/module/@MODULE_ID@/reports/patientSearchForm</value></property>
		<property name="successView"><value>patientSearch.list</value></property>
	</bean>

	<bean id="cohortBuilderController" class="org.openmrs.web.controller.analysis.CohortBuilderController">
		<property name="formView"><value>/module/@MODULE_ID@/analysis/cohortBuilder</value></property>
		<property name="successView"><value>cohortBuilder.list</value></property>
		<property name="links">
			<list>
				<value>nealreport.form:reportingcompatibility.nealreport.ConsultReport.name:reportType=Consult Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.IncentiveReport.name:reportType=Incentive Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.ShortReport.name:reportType=Short Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.TbReport.name:reportType=TB Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.Cd4Report.name:reportType=CD4 Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.DeclineReport.name:reportType=Decline Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.Month6Report.name:reportType=Month6 Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.AlertReport.name:reportType=Alert Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.PmtctReport.name:reportType=PMTCT Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.PedReport.name:reportType=Ped Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.LongReport.name:reportType=Long Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.TracReport.name:reportType=TRAC Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.ExceptionReport.name:reportType=Exception Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.LostReport.name:reportType=Lost Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.FlatReport.name:reportType=Flat Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.FoodPatientsReport.name:reportType=Food Patients Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.AccompLeaderReport.name:reportType=Accompagnateur Leader Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.TracRegisterReport.name:reportType=Trac Register Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.ChaiReport.name:reportType=CHAI Report</value>
				<value>nealreport.form:reportingcompatibility.nealreport.DataDumpReport.name:reportType=Data Dump</value>
			</list>
		</property>
	</bean>
    <bean id="cohortBuilderActionController" class="org.springframework.web.servlet.mvc.multiaction.MultiActionController">
		<property name="methodNameResolver"><ref bean="defaultMethodParamResolver"/></property>
		<property name="delegate"><ref bean="cohortBuilderController"/></property>
	</bean>

</beans>
